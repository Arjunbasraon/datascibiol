---
title: ""
date: "`r Sys.Date()`"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Learning Goals
*At the end of this exercise, you will be able to:*    


## Review
At this point, you should be comfortable using the `select()` and `filter()` functions of `dplyr`. If you need extra help, please [email me](mailto: jmledford@ucdavis.edu).  

## Load the tidyverse and janitor
```{r message=FALSE, warning=FALSE}
library("tidyverse")
library("janitor")
library("skimr")
library("palmerpenguins")
```

`count()` is an easy way of determining how many observations you have within a column. It effectively acts like a combination of `group_by()` and `n()`.
```{r}
msleep %>% 
  count(vore, sort = T)
```

Compare this with `summarize()` and `group_by()`.
```{r}
msleep %>% 
  group_by(vore) %>% 
  summarize(n=n())
```

What if we want to remove the NAs?
```{r}
msleep %>% 
  filter(!is.na(vore)) %>% 
  count(vore, sort = T)
```

`add_count()` adds a new column to the data frame.
```{r}
msleep %>% 
  add_count(vore)
```

You can also use `count()` across multiple variables.
```{r}
msleep %>% 
  count(order, vore, sort = TRUE)
```

For counts, I am starting to prefer `tabyl()`. Lots of options are supported in [tabyl](https://cran.r-project.org/web/packages/janitor/vignettes/tabyls.html)
```{r}
msleep %>% 
  tabyl(order, vore) %>% 
  adorn_percentages("row") %>%
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns()
```

## `across()`
Last time we had some great questions on how to use `filter()` and `select()` across multiple variables. There is a new function in dplyr called `across()` which is designed to work across multiple variables. Have a look at Rebecca Barter's awesome blog [here](http://www.rebeccabarter.com/blog/2020-07-09-across/) as I am following her below.  
```{r}
penguins
```

What if we wanted to apply summarize in order to produce distinct counts over multiple variables; i.e. species, island, and sex?
```{r}
penguins %>%
  summarise(distinct_species = n_distinct(species),
            distinct_island = n_distinct(island),
            distinct_sex = n_distinct(sex))
```

By using `across()` we can reduce the clutter and make things cleaner.
```{r}
penguins %>%
  summarise(across(c(species, island, sex), 
                   n_distinct))
```

Operators can also work, here I am summarizing `n_distinct()` across all variables except `species`, `island`, and `sex`.
```{r}
penguins %>%
  summarise(across(!c(species, island, sex), 
                   n_distinct))
```

Here we summarize across all variables...
```{r}
penguins %>%
  summarise(across(everything(), n_distinct))
```

All variables that include "bill"...
```{r}
penguins %>%
  summarise(across(starts_with("bill"), n_distinct))
```

...all of the other dplyr operators also work.
```{r}
penguins %>%
  summarise(across(contains("length"), n_distinct))
```