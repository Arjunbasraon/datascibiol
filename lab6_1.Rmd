---
title: "Data Visualization"
author: "Joel Ledford"
date: "Winter 2019"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Group Project
Brief check-in with your group. Now is the time to start working on data tidying and exploration. Make a plan!  

##Resources
- [ggplot2 cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)
- [R for Data Science](https://r4ds.had.co.nz/)
- [R Cookbook](http://www.cookbook-r.com/)
- [`ggplot` themes](https://ggplot2.tidyverse.org/reference/ggtheme.html)
- [Rebecca Barter `ggplot` Tutorial](http://www.rebeccabarter.com/blog/2017-11-17-ggplot2_tutorial/)

## Learning Goals
*At the end of this exercise, you will be able to:*    
1. Understand and apply the syntax of building plots using `ggplot2`.  
2. Build a boxplot using `ggplot2`.  
3. Build a scatterplot using `ggplot2`.  
4. Build a barplot using `ggplot2` and show the difference between `stat=count` and `stat=identity`.  

## Load the libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(skimr)
```

## Aesthetics
Now that we have practiced scatterplots, barplots, and boxplots we need to learn how to adjust their appearance to suit our needs. For these examples, I am going to use the dataset `gapminder`. This dataset includes information about economics, population, and life expectancy from countries all over the world.

```{r}
#install.packages("gapminder")
```

```{r}
library("gapminder")
```

```{r}
gapminder <- 
  gapminder::gapminder # loads the data into a new object
```

## Practice
1. Take a few minutes to explore the data using the functions that you have learned. Make sure to get a good idea of the structure of ther data, including NA's, and an evaluation of whether or not it is tidy.
```{r}
glimpse(gapminder)
```

```{r}
dim(gapminder)
```

```{r}
names(gapminder)
```

```{r}
head(gapminder)
```

```{r}
skimr::skim(gapminder)
```

##Scatterplots
For the first example, we will work through the code to produce the scatterplot below. It compares per capita GDP and life expectancy in 2007 with some fancy aesthetics. Have a quick look at the plot so that you know where we are going. Since this is focused on 2007, I filtered the data for that year but all other commands are associated with the ggplot output. The idea for this came from [Rebecca Barter's](http://www.rebeccabarter.com/blog/2017-11-17-ggplot2_tutorial/) ggplot tutorial so if you get lost go have a look.
```{r}
gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)+
  scale_x_log10(limits = c(200, 60000))+
  labs(title = "GDP vs. Life expectancy \n(2007)",
       x = "GDP per capita (log 10)",
       y = "Life expectancy",
       size = "Population",
       color = "Continent")+
  scale_size(range = c(0.1, 10),
             guide = "none")+
  theme_linedraw()+
  theme(legend.position = "right",
        axis.line = element_line(color = "grey85"),
        axis.ticks = element_line(color = "grey85"))
```

The first few lines should be relatively straightforward. We are identifying the x and y variables, coloring each point by continent, and adjusting the size of each point by population. Try removing the color and size aesthetics and look at the result. The last aesthetic in `geom_point` is alpha and that controls the transparency of the points. This can help with overplotting and also allows us to visualize differences on a finer scale because we can see the background.
```{r}
gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)
```

In this example, I have re-scaled the x axis. The default is `scale_*_continuous` where the * is the x or y variable. The scale aesthetics are helpful for adjusting the plot to our range of interest. Try readjusting the x axis to 20000, 50000 as an experiment. 
```{r}
gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)+
  scale_x_continuous(limits = c(200, 50000))
```

Because there are such large differences in per capita GDP, we can also log transform the x-axis. In our example, we used `scale_x_log10(limits = c(200, 60000))` in order to better spread the data.
```{r}
gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)+
  scale_x_log10(limits = c(200, 60000))
```

You will frequently want to rename axes and keys when building plots because most variable names don't make sense to people unfamiliar with the data. One thing to note here is that I use `\n` as part of the title. This is interpreted as a line break. Remove this and see how it affects the title.
```{r}
gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)+
  scale_x_log10(limits = c(200, 60000))+
  labs(title = "GDP vs. Life expectancy \n(2007)",
       x = "GDP per capita (log 10)",
       y = "Life expectancy",
       size = "Population",
       color = "Continent")
```

Scale size specifies a discrete range for the size of the points according to population. Try adjusting the range to see the effect. `guide=none` removes the population part of the key to clean up the plot.
```{r}
gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)+
  scale_x_log10(limits = c(200, 60000))+
  labs(title = "GDP vs. Life expectancy \n(2007)",
       x = "GDP per capita (log 10)",
       y = "Life expectancy",
       size = "Population",
       color = "Continent")+
  scale_size(range = c(0.5, 12),
             guide = "none")
```

This brings us to the built-in themes which are quick ways to adjust aesthetics for a uniform look. There are many built-in themes and most of their internal aesthetics are adjustable. Take a few moments to try out different examples.
```{r}
?theme_linedraw
```

```{r}
gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)+
  scale_x_log10(limits = c(200, 60000))+
  labs(title = "GDP vs. Life expectancy \n(2007)",
       x = "GDP per capita (log 10)",
       y = "Life expectancy",
       size = "Population",
       color = "Continent")+
  scale_size(range = c(0.1, 10),
             guide = "none")+
  theme_linedraw()+
  theme(legend.position = "right",
        axis.line = element_line(color = "grey85"),
        axis.ticks = element_line(color = "grey85"))
```

A nice way to try out different themes is to build the plot as a new object and then add the theme directly.
```{r}
plot <- gapminder %>%
  filter(year==2007) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, color=continent, size=pop))+
  geom_point(alpha=0.75)+
  scale_x_log10(limits = c(200, 60000))+
  labs(title = "GDP vs. Life expectancy \n(2007)",
       x = "GDP per capita (log 10)",
       y = "Life expectancy",
       size = "Population",
       color = "Continent")+
  scale_size(range = c(0.1, 10),
             guide = "none")
```

```{r}
plot + 
  theme_linedraw()
```

## Practice
Let's continue using the `gapminder` dataset. Where appropriate, add aesthetic elements using code from the examples above.
```{r}
options(scipen=999)
glimpse(gapminder)
```

1. What is the population for all countries on the Asian continent in 2007? Show this as a barplot. Fill each bar by per capita gdp. 
```{r}
gapminder %>%
  filter(year==2007, continent=="Asia") %>% 
  ggplot(aes(x=reorder(country, -pop), y=pop))+
  geom_col(fill="steelblue", alpha=0.8)+
  coord_flip()+
  labs(title = "Population on Asian Continent (2007)",
       x = "Population",
       y = "Country")+
  theme_linedraw()+ 
  theme(plot.title = element_text(size = rel(1.5), hjust = 0.5))
```

2. Are there any outliers in question 1? Remove those and re-plot.
```{r}
gapminder %>%
  filter(year==2007, continent=="Asia") %>% 
  filter(!country=="India" & !country=="China") %>% 
  ggplot(aes(x=country, y=pop, fill=gdpPercap))+
  geom_col()+
  coord_flip()+
  labs(title = "Population on Asian Continent (2007)",
       x = "Population",
       y = "Country")+
  theme_linedraw()+
  theme(legend.position = "right",
        axis.line = element_line(color = "grey85"),
        axis.ticks = element_line(color = "grey85"))
```

3. Indonesia looks especially interesting. Build a plot that shows how gdpPercap has changed over the years 1952-2007.
```{r}
gapminder %>% 
  filter(country=="Indonesia") %>% 
  select(-country, -continent, -lifeExp) %>% 
  ggplot(aes(x=year, y=gdpPercap))+
  geom_col()+
  scale_x_continuous(breaks=seq(1952,2007,5))+
  labs(title = "Indonesian gdpPercap (1952-2007)",
       x = "Year",
       y = "gdpPercap")
```

## Let's Take a Break!